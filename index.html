<!-- Full-screen view with no title bar, explicit full-bleed (small border matches device casing) -->
<div class="view view--full no-margin no-padding">
  <div class="layout w--full h--full no-margin no-padding" style="margin: 0; padding: 0;">
    <!-- Image, fills container while maintaining aspect ratio -->
    <img class="image image-dither" id="movie-poster" src="https://secret-wizard.github.io/movie-title-screens/1990s/babyblood1990bd.jpg" alt="1990s Movie Title Screen">
    <!-- Hidden element to store current image index -->
    <div id="image-index" style="display: none;" data-index="0"></div>
  </div>
</div>

<style>
  .image {
    position: relative;
    object-fit: cover;
    object-position: center;
    margin: 0;
    padding: 0;
    width: 100%;
    height: 480px;
  }
</style>

<!-- Plugin logic (no external TRMNL JS dependency) -->
<script>
  // URL of the JSON file with cache-busting parameter
  const jsonUrl = 'https://secret-wizard.github.io/movie-title-screens/1990s/images.json?t=' + Date.now();

  // Fisher-Yates shuffle algorithm
  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  // Global array to hold shuffled image URLs
  let shuffledImages = [];

  // Function to fetch and shuffle image URLs
  function fetchAndShuffleImageUrls() {
    console.log('Fetching and shuffling new image list...');
    const xhr = new XMLHttpRequest();
    xhr.open('GET', jsonUrl, true);
    xhr.onreadystatechange = function () {
      if (xhr.readyState === 4) {
        if (xhr.status === 200) {
          const data = JSON.parse(xhr.responseText);
          if (data.images && data.images.length > 0) {
            shuffledImages = shuffle([...data.images]);
            console.log(`New image set created with ${shuffledImages.length} images`);
            setRandomImage();
          } else {
            console.error('No images found in JSON');
          }
        } else {
          console.error(`Failed to fetch JSON: ${xhr.status}`);
        }
      }
    };
    xhr.send();
  }

  // Function to set a random image
  function setRandomImage() {
    const imageIndex = document.getElementById('image-index');
    if (shuffledImages.length > 0) {
      const randomIndex = Math.floor(Math.random() * shuffledImages.length);
      imageIndex.dataset.index = randomIndex;
      const selectedUrl = shuffledImages[randomIndex];
      console.log(`Displaying image: ${selectedUrl}`);
      document.getElementById('movie-poster').src = selectedUrl;
    } else {
      console.error('No images available to display');
    }
  }

  // Initialize and set initial image on load (TRMNL should re-execute this on poll)
  console.log('Initializing plugin...');
  fetchAndShuffleImageUrls();
</script>
