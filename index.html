<div class="view view--full no-margin no-padding" style="width:100%;height:100%;">
  <img id="poster"
       class="image image-dither"
       alt="Movie title screen"
       style="width:100%;height:480px;object-fit:cover;object-position:center;">
</div>

<style>
  .canvas-outer {
    padding:0 !important;
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {

  const decade = '{{ trmnl.plugin_settings.custom_fields_values.decade | default: "1990s" }}';

  /* Direct GitHub raw URL — no AllOrigins needed --------------------------- */
  const jsonUrl = `https://raw.githubusercontent.com/secret-wizard/movie-title-screens/main/${decade}/images.json`;

  function shuffle(arr){
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function showRandomPoster(){
    fetch(jsonUrl)
      .then(r => r.ok ? r.json() : Promise.reject(r.status))
      .then(data => {
        if (!data.images || !data.images.length) throw 'empty list';
        const chosen = shuffle(data.images)[0];
        document.getElementById('poster').src = chosen;
        console.log(`[TRMNL-Movie-Screens] ${decade} → ${chosen}`);
      })
      .catch(err => console.error('[TRMNL-Movie-Screens] fetch error:', err));
  }

  showRandomPoster();
});
</script>
